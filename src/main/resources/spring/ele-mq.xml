<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
  		http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
    	http://www.springframework.org/schema/rabbit
        http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd">

    <!-- MQ连接服务配置 -->
    <bean id="taskExecutor2" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor">
        <!--核心线程数 -->
        <property name="corePoolSize" value="100"/>
        <!--线程池维护线程所允许的空闲时间 -->
        <property name="keepAliveSeconds" value="3000"/>
        <!--线程池对拒绝任务(无线程可用)的处理策略 -->
        <property name="rejectedExecutionHandler">
            <bean class="java.util.concurrent.ThreadPoolExecutor$CallerRunsPolicy"/>
        </property>
        <property name="WaitForTasksToCompleteOnShutdown" value="true"/>
    </bean>

    <!-- apollo mq连接配置 -->
    <rabbit:connection-factory id="connectionFactory2"
                               host="vpca-apollo-cis-rmq-1.vm.elenet.me" username="apollo" password="apollo"
                               port="5673" virtual-host="apollo"/>

    <!--老运单-->
    <rabbit:queue id="lpd.talaris.team.ts.apollo.sos.order"
                  name="lpd.talaris.team.ts.apollo.sos.order" durable="true" auto-delete="false"
                  exclusive="false"/>

    <!--新运单-->
    <rabbit:queue id="lpd.talaris.team.ts.apollo.nsos.order"
                  name="lpd.talaris.team.ts.apollo.nsos.order" durable="true" auto-delete="false"
                  exclusive="false"/>

    <!--骑手保险老运单-->
    <rabbit:queue id="lpd.talaris.team.tss.insurance.apollo.sos.order"
                  name="lpd.talaris.team.tss.insurance.apollo.sos.order" durable="true" auto-delete="false"
                  exclusive="false"/>

    <!--骑手保险新运单-->
    <rabbit:queue id="lpd.talaris.team.tss.insurance.apollo.nsos.order"
                  name="lpd.talaris.team.tss.insurance.apollo.nsos.order" durable="true" auto-delete="false"
                  exclusive="false"/>

    <bean id="apolloSubsidyConsumer" class="me.ele.meepo.statistic.consumer.ApolloSubsidyConsumer"></bean>
    <bean id="nApolloSubsidyConsumer" class="me.ele.meepo.statistic.consumer.NApolloSubsidyConsumer"></bean>
    <bean id="apolloTakerInsuranceConsumer" class="me.ele.meepo.statistic.consumer.ApolloTakerInsuranceConsumer"></bean>
    <bean id="nApolloTakerInsuranceConsumer"
          class="me.ele.meepo.statistic.consumer.NApolloTakerInsuranceConsumer"></bean>

    <rabbit:listener-container connection-factory="connectionFactory2" acknowledge="auto" task-executor="taskExecutor2"
                               concurrency="5">
        <rabbit:listener ref="nApolloSubsidyConsumer" queues="lpd.talaris.team.ts.apollo.nsos.order"/>
        <rabbit:listener ref="apolloSubsidyConsumer" queues="lpd.talaris.team.ts.apollo.sos.order"/>
        <rabbit:listener ref="apolloTakerInsuranceConsumer" queues="lpd.talaris.team.tss.insurance.apollo.sos.order"/>
        <rabbit:listener ref="nApolloTakerInsuranceConsumer" queues="lpd.talaris.team.tss.insurance.apollo.nsos.order"/>
    </rabbit:listener-container>

</beans>
